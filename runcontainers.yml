---
- hosts: datacenter_host
  gather_facts: true
  become: false
  vars:
    base_dir: "~/"
  tasks:
    # - name: build the images
    #   docker_image:
    #     name: "{{item}}"
    #     tag: latest
    #     path: "{{item}}"
    #     state: present
    #   with_items:
    #     - pyfln-auth
    #     - pyfln-ui

    - name: run mongodb in container
      docker_container:
        name: pyfln-mongodb
        image: "mongo:4.0.9"
        state: started
        ports:
          - "27017:27017"

    - name: run pyfln-auth in a docker container
      docker_container:
        name: pyfln-auth
        image: pyfln-auth:1.0.0
        volumes:
          - "/var/www/pyfln-auth/instance/app.cfg:/opt/app-root/var/app-instance/app.cfg"
        state: started
        ports:
          - "8082:8000"

      
    - name: run pyfln-ui in a docker container
      docker_container:
        name: pyfln-ui
        image: pyfln-ui:1.0.0
        state: started
        env:
          API_ENDPOINT: http://127.0.0.1:8082
        ports:
          - "8081:8080"